<div class="d-flex flex-column section">
    <div class="section head">Client profiles</div>

    <div class="d-flex">
        <mat-form-field appearance="fill" class="bigger">
            <mat-label>Available server side profiles</mat-label>
            <mat-select [(ngModel)]="configService.clientConfig" [compareWith]="compareProfile">
                <mat-option (click)="configService.addNewClientConfig()">CREATE NEW PROFILE</mat-option>
                <mat-option [value]="clientConfig"
                    *ngFor="let clientConfig of configService?.serverConfig?.clientConfig"
                    (click)="selectConfig(clientConfig)">
                    {{clientConfig.clientName}}</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="smaller">
            <mat-label>rename profile to</mat-label>
            <input matInput class="align-self-center" type="text" [(ngModel)]="newProfileName">
            <mat-icon matSuffix class="icn" svgIcon="rename-box" (click)="renameProfile()"></mat-icon>
        </mat-form-field>
    </div>

    <mat-form-field appearance="fill">
        <mat-label>Default Media Renderer</mat-label>
        <mat-select [(ngModel)]="configService.clientConfig.defaultMediaRenderer" [compareWith]="compareUdn"
            placeholder="select server defined profile">
            <mat-option [value]="none_device" (click)="noRendererSelected()">NONE</mat-option>
            <mat-option [value]="mr" *ngFor="let mr of deviceService.getMediaRendererList()">
                {{mr.friendlyName}}</mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Default Media Server</mat-label>
        <mat-select [(ngModel)]="configService.clientConfig.defaultMediaServer" [compareWith]="compareUdn">
            <mat-option [value]="none_device" (click)="noServerSelected()">NONE</mat-option>
            <mat-option [value]="mediaServer" *ngFor="let mediaServer of deviceService.getMediaServerList()">
                {{mediaServer.friendlyName}}</mat-option>
        </mat-select>
    </mat-form-field>

    <div class="d-flex section ms-4">
        <button mat-flat-button color="primary" (click)="save()">save</button>
    </div>
</div>

<div class="section head">Media Renderer configuration</div>

<div>
    <div class="d-flex flex-row flex-wrap ms-4">
        <div class="cardContainer" *ngFor="let rendererConfig of configService.getRendererDevicesConfig()">
            <mat-card class="card-width me-4 mb-3">
                <mat-card-header>
                    <mat-card-title>{{rendererConfig.mediaRenderer.friendlyName}}</mat-card-title>
                    <mat-card-subtitle *ngIf="isRendererConfigActive(rendererConfig)">ONLINE</mat-card-subtitle>
                    <mat-card-subtitle>{{rendererConfig.displayString}} [{{rendererConfig.ip}}]</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <div>
                        <mat-slide-toggle class="mb-2" [(ngModel)]="rendererConfig.active">
                            Enable
                        </mat-slide-toggle>
                    </div>
                    <div>
                        <mat-form-field appearance="fill">
                            <mat-label>device driver type</mat-label>
                            <mat-select [(ngModel)]="rendererConfig.deviceDriverType">
                                <mat-option>None</mat-option>
                                <mat-option [value]="dd.deviceType" *ngFor="let dd of configService.deviceDriverList">
                                    {{dd.deviceType}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div>
                        <mat-form-field appearance="fill">
                            <mat-label>device driver connection</mat-label>
                            <input matInput type="text" [(ngModel)]="rendererConfig.connectionString"
                                placeholder="ip:port">
                        </mat-form-field>
                    </div>
                    <div>
                        <mat-form-field appearance="fill">
                            <mat-label>power on defaut volume</mat-label>
                            <input matInput type="number" min="0" max="100"
                                [(ngModel)]="rendererConfig.powerOnVolPercent" placeholder="undefined">
                        </mat-form-field>
                    </div>
                    <div class="middle-spacer">&nbsp;</div>
                    <div class="d-flex">
                        <button mat-flat-button class="ms-2" color="primary"
                            (click)="saveRendererConfig(rendererConfig)">Save</button>
                        <button mat-flat-button class="ms-2" color="warn"
                            (click)="deleteRendererConfig(rendererConfig)">Delete</button>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    <!-- -->
    <div class="section head ">Administration</div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-4">Build number</div>
            <div class="col-8">{{buildNumber}}</div>
        </div>
    </div>

    <div class="section subhead subsect">active media server actions</div>
    <div class="section subhead d-flex flex-column">
        <div class="d-flex flex-wrap">
            <button mat-flat-button class="ms-2 settings maxButton" (click)="rescan()"
                [disabled]="extendedApiNotAvailable()">Rescan media library</button>
            <button mat-flat-button class="ms-2 settings maxButton" (click)="myMusicService.backupLikedAlbums()"
                [disabled]="extendedApiNotAvailable()">
                backup liked albums
            </button>
            <button mat-flat-button class="ms-2 settings maxButton" (click)="myMusicService.restoreLikedAlbums()"
                [disabled]="extendedApiNotAvailable()">
                restore liked albums
            </button>
        </div>
        <div d-flex flex-column>
            <div>import star rating from musicbrainz.org (need media server support)</div>
            <button mat-flat-button class="ms-2 settings maxButton" [disabled]="extendedApiNotAvailable()"
                (click)="ratingServiceService.syncRatingsFromMusicBrainzToBackend()">sync</button>
        </div>
    </div>

    <div class="section subhead subsect">Last FM</div>
    <div class="d-flex section flex-wrap subhead flex-column">
        <div class="para">
            1. Click this button. A new window will open. Login and approve access to nextCP/2 :
        </div>
        <button mat-flat-button class="settings maxButton" (click)="activateLastFM()">
            nextCP/2 LastFM access
        </button>
        <div class="para">
            2. After step 1 is done, click this button to connect nextCP/2 to LastFM :
        </div>
        <button mat-flat-button class="settings maxButton" (click)="generateSession()">
            generate LastFM session
        </button>
    </div>

    <div class="section subhead subsect">Spotify</div>
    <div class="para" *ngIf="configService.spotifyAccountConnected()">
        Your Spotify account is connected.
    </div>
    <div class="d-flex section flex-wrap subhead flex-column" *ngIf="!configService.spotifyAccountConnected()">
        <div class="para">
            1. Click this button. A new window will open. Login and approve access to nextCP/2 :
        </div>
        <button id="spotifyLoginBtn" mat-flat-button class="settings maxButton"
            (click)="registerAppAtSpotify()">nextCP/2 Spotify access
        </button>
        <div class="para">
            2. After granting access you wil be redirected to a localhost URL (error page). Copy spotify access code
            from your browsers URL bar into the input field below and
        </div>
        <div>
            <input class="section input" [(ngModel)]="code">
        </div>
        <button id="spotifyLoginBtn" mat-flat-button class="settings maxButton" (click)="sendSpotifyCode()">send
            it</button>
        <div class="para">
            Hint: To copy the access code, click in your browsers URL bar and copy everything after
            'http://localhost:65525/?code='
        </div>
    </div>
</div>