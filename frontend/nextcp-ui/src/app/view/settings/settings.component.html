<div class="d-flex flex-column section">
    <div class="section head">Client Profiles</div>
    <div class="para m-3">Select a client profile to associate with this browser. Repeated calls with this browser will select renderer and server by default.
        Profiles should be renamed to some meaningful name like 'livingroom' or 'kitchen' for easy to remember and switchable setup.
    </div>
    <div class="d-flex flex-wrap">
        <mat-form-field appearance="fill" class="bigger">
            <mat-label>select profile or create new one</mat-label>
            <mat-select [(ngModel)]="configService.clientConfig" [compareWith]="compareProfile">
                <mat-option (click)="configService.addNewClientConfig()">CREATE NEW PROFILE</mat-option>
                <mat-option [value]="clientConfig"
                    *ngFor="let clientConfig of configService?.serverConfig?.clientConfig"
                    (click)="selectConfig(clientConfig)">
                    {{clientConfig.clientName}}</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="smaller">
            <mat-label>rename profile to</mat-label>
            <input matInput class="align-self-center" type="text" [(ngModel)]="newProfileName">
            <span matSuffix class="material-symbols-outlined icon-middle md-18" (click)="renameProfile()">edit</span>
        </mat-form-field>
    </div>

    <mat-form-field appearance="fill">
        <mat-label>Default Media Renderer</mat-label>
        <mat-select [(ngModel)]="configService.clientConfig.defaultMediaRenderer" [compareWith]="compareUdn"
            placeholder="select server defined profile">
            <mat-option [value]="none_renderdevice" (click)="noRendererSelected()">NONE</mat-option>
            <mat-option [value]="mr" *ngFor="let mr of deviceService.getMediaRendererList()">
                {{mr.friendlyName}}</mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Default Media Server</mat-label>
        <mat-select [(ngModel)]="configService.clientConfig.defaultMediaServer" [compareWith]="compareUdn">
            <mat-option [value]="none_serverdevice" (click)="noServerSelected()">NONE</mat-option>
            <mat-option [value]="mediaServer" *ngFor="let mediaServer of deviceService.getMediaServerList()">
                {{mediaServer.friendlyName}}</mat-option>
        </mat-select>
    </mat-form-field>

    <div class="d-flex section ms-4">
        <button mat-flat-button color="primary" (click)="saveClientConfig()">save</button>
        <button mat-flat-button class="ms-2" color="warn" (click)="deleteClientConfig()">delete</button>        
    </div>
</div>

<div class="section head">Server Configuration</div>
<div class="para m-3">Media Server displayed here were discovered in the past until now. Server may be offline, if not yet found.
    Disabled server will not show up for selection in some popups or lists.
</div>
<div class="para m-3 mb-3">Important: If an Universal Media Server (UMS) is found, enter the API key from UMS.conf, for unlocking
    all features. Otherwise most audio convenience functions will not work!
</div>

<div class="d-flex flex-row flex-wrap ms-4">
    <div class="cardContainer" *ngFor="let serverConfig of configService?.getServerConfig()?.serverDevices">
        <mat-card class="card-width me-4 mb-3">
            <mat-card-subtitle class="no-wrap myCardTitle mb-3">{{serverConfig.mediaServer.friendlyName}}
            </mat-card-subtitle>
            <mat-card-subtitle class="online" *ngIf="isServerConfigActive(serverConfig)">ONLINE</mat-card-subtitle>
            <mat-card-subtitle class="offline" *ngIf="!isServerConfigActive(serverConfig)">OFFLINE</mat-card-subtitle>
            <mat-card-subtitle>IP: {{serverConfig.ip}}</mat-card-subtitle>
            <mat-card-subtitle>UDN: {{serverConfig.mediaServer.udn}}</mat-card-subtitle>
            <mat-card-content>
                <section>
                    <mat-slide-toggle class="mb-2" [(ngModel)]="serverConfig.enabled">
                        Enable
                    </mat-slide-toggle>
                </section>
                <section *ngIf="serverConfig.mediaServer.extendedApi">
                    <mat-form-field appearance="fill">
                        <mat-label>API key</mat-label>
                        <input matInput type="text" [(ngModel)]="serverConfig.apiKey"
                            placeholder="must match with 'api_key' in UMS.conf">
                    </mat-form-field>
                </section>
                <div class="d-flex mt-4">
                    <button mat-flat-button class="ms-2" color="primary"
                        (click)="saveServerConfig(serverConfig)">save</button>
                    <button mat-flat-button class="ms-2" color="warn"
                        (click)="deleteServerConfig(serverConfig)">delete</button>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>

<div class="section head">Renderer Configuration</div>
<div class="para m-3">Media Renderer displayed here were discovered in the past until now. Renderer may be offline, if not yet found.
    Disabled renderer will not show up for selection in some popups or lists.
</div>
<div class="para m-3">If a streaming device is attached to an amplifier, a device device driver can be selected for controling the amplifier power and volume state
    instead of the streamer volume and power state. A default volume percentage can be applied to the external amplifier on power up. The streaming device volume can be
    set to 100% on power up, if 'UPnP max volume' is enabled.
</div>
<div>
    <div class="d-flex flex-row flex-wrap ms-4">
        <div class="cardContainer" *ngFor="let rendererConfig of configService.getRendererDevicesConfig()">
            <mat-card class="card-width me-4 mb-3">
                <mat-card-title class="no-wrap mb-3">{{rendererConfig.mediaRenderer.friendlyName}}</mat-card-title>
                <mat-card-subtitle class="online" *ngIf="isRendererConfigActive(rendererConfig)">ONLINE
                </mat-card-subtitle>
                <mat-card-subtitle class="offline" *ngIf="!isRendererConfigActive(rendererConfig)">OFFLINE
                </mat-card-subtitle>
                <mat-card-subtitle class="no-wrap">{{rendererConfig.displayString}}</mat-card-subtitle>
                <mat-card-subtitle>IP: {{rendererConfig.ip}}</mat-card-subtitle>
                <mat-card-subtitle>UDN: {{rendererConfig.mediaRenderer
                    .udn}}</mat-card-subtitle>
                <mat-card-content>
                    <section>
                        <mat-slide-toggle class="mb-2" [(ngModel)]="rendererConfig.active">
                            Enable
                        </mat-slide-toggle>
                    </section>
                    <section>
                        <mat-form-field appearance="fill">
                            <mat-label>device driver type</mat-label>
                            <mat-select [(ngModel)]="rendererConfig.deviceDriverType">
                                <mat-option value="">None</mat-option>
                                <mat-option [value]="dd.deviceType" *ngFor="let dd of configService.deviceDriverList">
                                    {{dd.deviceType}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field appearance="fill">
                            <mat-label>device driver connection</mat-label>
                            <input matInput type="text" [(ngModel)]="rendererConfig.connectionString"
                                placeholder="ip:port">
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field appearance="fill">
                            <mat-label>power on defaut volume</mat-label>
                            <input matInput type="number" min="0" max="100"
                                [(ngModel)]="rendererConfig.powerOnVolPercent" placeholder="undefined">
                        </mat-form-field>
                        <mat-slide-toggle class="mb-2" [(ngModel)]="rendererConfig.setCoveredUpnpDeviceToMaxVolume"
                            [disabled]="!rendererConfig.deviceDriverType">
                            UPnP max volume
                        </mat-slide-toggle>
                    </section>
                    <div class="middle-spacer">&nbsp;</div>
                    <div class="d-flex mt-4">
                        <button mat-flat-button class="ms-2" color="primary"
                            (click)="saveRendererConfig(rendererConfig)">save</button>
                        <button mat-flat-button class="ms-2" color="warn"
                            (click)="deleteRendererConfig(rendererConfig)">delete</button>
                    </div>
                    <div class="middle-spacer">&nbsp;</div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    <!-- -->
</div>
<div class="section head ">Active Media Server</div>
<div class="section subhead subsect" *ngIf="!extendedApiNotAvailable()">Actions for currently selected media server:
</div>
<div class="section subhead subsect" *ngIf="extendedApiNotAvailable()">Advanced actions are only available for Universal
    Media Player.</div>
<div class="section subhead d-flex flex-column">
    <div class="d-flex flex-wrap">
        <button mat-flat-button class="ms-2 settings maxButton" (click)="rescan()"
            [disabled]="extendedApiNotAvailable()">rescan media library</button>
        <button mat-flat-button class="ms-2 settings maxButton" (click)="myMusicService.backupLikedAlbums()"
            [disabled]="extendedApiNotAvailable()">
            backup liked albums
        </button>
        <button mat-flat-button class="ms-2 settings maxButton" (click)="myMusicService.restoreLikedAlbums()"
            [disabled]="extendedApiNotAvailable()">
            restore liked albums
        </button>
    </div>
    <div d-flex flex-column>
        <div>import star rating from musicbrainz.org</div>
        <button mat-flat-button class="ms-2 settings maxButton" [disabled]="extendedApiNotAvailable()"
            (click)="ratingServiceService.syncRatingsFromMusicBrainzToBackend()">sync</button>
    </div>
</div>


<div class="section head ">General Configuration</div>

<div class="generalConfigOptions">
    <div class="section subhead d-flex flex-column">
        <mat-form-field appearance="fill">
            <mat-label>device driver library path</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.libraryPath"
                placeholder="undefined">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>database path</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.databaseFilename"
                placeholder="undefined">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>server listening port</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.embeddedServerPort"
                placeholder="undefined">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Log4j config file</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.log4jConfigFile"
                placeholder="undefined">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Logging date format</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.loggingDateTimeFormat"
                placeholder="yyyy-MM-dd HH:mm:ss">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Generate UPnP code</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.generateUpnpCode" placeholder="">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>path for generated UPnP code</mat-label>
            <input matInput type="text" [(ngModel)]="configService.applicationConfig.generateUpnpCodePath"
                placeholder="">
        </mat-form-field>
        <div class="d-flex section ms-4">
            <button mat-flat-button color="primary" (click)="saveGeneralConfig()">save</button>
        </div>
    </div>
</div>

<div class="section head ">Accounts</div>

<div class="section subhead subsect">Spotify</div>
<div class="d-flex section flex-wrap subhead flex-column">
    <div class="para" *ngIf="configService.spotifyAccountConnected()">
        <span class="material-symbols-outlined" style="color: aqua;">how_to_reg</span>
        <span class=""> Your Spotify account is connected.</span>
    </div>
</div>
<div class="d-flex section flex-wrap subhead flex-column" *ngIf="!configService.spotifyAccountConnected()">
    <div class="para">
        Click this button. A new window will open. Login and approve access to nextCP/2 :
    </div>
    <button id="spotifyLoginBtn" mat-flat-button class="settings maxButton" (click)="registerAppAtSpotify()">nextCP/2
        Spotify access
    </button>

    <div *ngIf="!protocolHandlerAvailable()">
        <div class="para">
            After granting access you wil be redirected to a localhost URL (error page). Copy spotify access code
            from your browsers URL bar into the input field below and
        </div>
        <div>
            <input class="section input" [(ngModel)]="code">
        </div>
        <button id="spotifyLoginBtn" mat-flat-button class="settings maxButton" (click)="sendSpotifyCode()">send
            it</button>
        <div class="para">
            Hint: To copy the access code, click in your browsers URL bar and copy everything after
            'http://localhost:65525/?code='
        </div>
    </div>
</div>

<div class="section subhead subsect">MusicBrainz</div>
<div class="d-flex section flex-wrap subhead flex-column">
    <div class="para">
        Star-rating will update musicbrainz.org site if song has musicbrainzID metadata set. Password will be encoded after a successfull save action.
    </div>
</div>
<div class="d-flex flex-wrap">
    <div class="d-flex section flex-wrap subhead flex-wrap">
        <mat-form-field appearance="fill">
            <mat-label>Username</mat-label>
            <input matInput type="text" placeholder="for www.musicbrainz.org" [(ngModel)]="configService.musicBrainzConfig.username">
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Password</mat-label>
            <input matInput type="text" placeholder="for www.musicbrainz.org" [(ngModel)]="configService.musicBrainzConfig.password">
        </mat-form-field>
        <div class="d-flex section ms-4">
            <button mat-flat-button color="primary" (click)="saveMusicBrainzConfig()">save</button>
        </div>
    </div>
</div>

<div class="section subhead subsect">Last FM</div>
<div class="d-flex section flex-wrap subhead flex-column">
    <div class="para">
        1. Click this button. A new window will open. Login and approve access to nextCP/2 :
    </div>
    <button mat-flat-button class="settings maxButton" (click)="activateLastFM()">
        nextCP/2 LastFM access
    </button>
    <div class="para">
        2. After step 1 is done, click this button to connect nextCP/2 to LastFM :
    </div>
    <button mat-flat-button class="settings maxButton" (click)="generateSession()">
        generate LastFM session
    </button>
</div>

<div class="section head ">System Information</div>
<div class="generalConfigOptions">
    <div class="section subhead d-flex flex-column">
        <mat-form-field>
            <mat-label>build number</mat-label>
            <input matInput type="text" [ngModel]="buildNumber" placeholder="undefined" readonly="true">
        </mat-form-field>
    </div>
</div>